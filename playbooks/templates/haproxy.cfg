global
	log /dev/log	local0
	log /dev/log	local1 notice
	chroot /var/lib/haproxy
	stats socket /run/haproxy/admin.sock mode 660 level admin
	stats timeout 30s
	user haproxy
	group haproxy
	daemon

defaults
	log global
	mode http
	option httplog
	option dontlognull
	retries 3
	option redispatch
	option httpchk GET /healthcheck HTTP/1.0
	timeout connect 5s
	timeout client 1m
	timeout server 1m

listen service-01
	bind *:1001
	{% for server in backend_servers -%}
	server {{ server['name'] }} {{ server['ip'] }}:1001 check inter 2s rise 2 fall 3
	{% endfor %}
	
listen service-02
	bind *:1002
	{% for server in backend_servers -%}
	server {{ server['name'] }} {{ server['ip'] }}:1002 check inter 2s rise 2 fall 3
	{% endfor %}

listen stats
	bind *:1111
	stats enable
	stats uri /haproxy?stats
	stats refresh 1s
	# stats admin if TRUE
